{
    "collab_server" : "",
    "contents" : "# Barplot with double Y-axis\n# H. Achicanoy\n# CIAT, 2016\n\n# R options\noptions(warn = -1)\noptions(scipen = 999)\n\n# load packages\nsuppressMessages(library(ggplot2))\nsuppressMessages(library(dplyr))\nsuppressMessages(library(tidyr))\nsuppressMessages(library(grid))\nsuppressMessages(library(gtable))\n\n#setwd('C:/Users/haachicanoy/Documents/CIAT/Asesorias/Fabio Castro/_future')\n#setwd(\"D:/CC/_bd/_costaMarfil/_tables/_tablesToGraphs/_future\")\n#setwd(\"D:/CC/_bd/_malawi/_tables/_climate/_toGraphs\")\n# setwd('W:/_climateGraphs/_honduras/_tables')\nsetwd('Z:/_cam/_workspace/_graphPointsCocoa')\nsource('Z:/_cam/_codes/_r/_niceGraph/dual_axis_function.R')\n\n# Current data\n# Metrics <- c('min', 'mean', 'max')\nmetrics <- 'mean'\ncurrentInfo <- lapply(metrics, function(x){\n  file <- list.files(path = './_current', pattern = x, full.names = T)\n  data <- read.csv(file)\n  data <- data[, c(\"zone\", \"prec_1\", \"prec_10\", \"prec_11\", \"prec_12\", \"prec_2\", \"prec_3\", \"prec_4\", \"prec_5\", \"prec_6\", \"prec_7\", \"prec_8\", \"prec_9\",\n                      \"tmax_1\", \"tmax_10\", \"tmax_11\", \"tmax_12\", \"tmax_2\", \"tmax_3\", \"tmax_4\", \"tmax_5\", \"tmax_6\", \"tmax_7\", \"tmax_8\", \"tmax_9\",\n                      \"tmean_1\", \"tmean_10\", \"tmean_11\", \"tmean_12\", \"tmean_2\", \"tmean_3\", \"tmean_4\", \"tmean_5\", \"tmean_6\", \"tmean_7\", \"tmean_8\", \"tmean_9\",\n                      \"tmin_1\", \"tmin_10\", \"tmin_11\", \"tmin_12\", \"tmin_2\", \"tmin_3\", \"tmin_4\", \"tmin_5\", \"tmin_6\", \"tmin_7\", \"tmin_8\", \"tmin_9\")]\n  data$varID  <- x\n  data$gcm    <- 'Present'\n  data$Period <- 'current'\n  return(data)\n})\ncurrentInfo <- do.call(rbind, currentInfo)\n\n# Future 2030\ngcmList     <- list.files(path = './_2030/', pattern = metrics[1], full.names = F)\ngcmList     <- gsub(pattern = 'mean_', replacement = '', x = gcmList, fixed = T)\ngcmList     <- gsub(pattern = '_2030.csv', replacement = '', x = gcmList, fixed = T)\ngcmList     <- gsub(pattern = '.csv', replacement = '', x = gcmList, fixed = T) # ADD FABIO\nfut2030Info <- lapply(metrics, function(x){\n  process   <- lapply(gcmList, function(y){\n    file    <- list.files(path = './_2030/', pattern = x, full.names = T)\n    file    <- file[grep(pattern = paste('_', y, '_2030', sep = ''), x = file)]\n    data    <- read.csv(file)\n    data    <- data[, c(\"zone\", \"prec_1\", \"prec_10\", \"prec_11\", \"prec_12\", \"prec_2\", \"prec_3\", \"prec_4\", \"prec_5\", \"prec_6\", \"prec_7\", \"prec_8\", \"prec_9\",\n                        \"tmax_1\", \"tmax_10\", \"tmax_11\", \"tmax_12\", \"tmax_2\", \"tmax_3\", \"tmax_4\", \"tmax_5\", \"tmax_6\", \"tmax_7\", \"tmax_8\", \"tmax_9\",\n                        \"tmean_1\", \"tmean_10\", \"tmean_11\", \"tmean_12\", \"tmean_2\", \"tmean_3\", \"tmean_4\", \"tmean_5\", \"tmean_6\", \"tmean_7\", \"tmean_8\", \"tmean_9\",\n                        \"tmin_1\", \"tmin_10\", \"tmin_11\", \"tmin_12\", \"tmin_2\", \"tmin_3\", \"tmin_4\", \"tmin_5\", \"tmin_6\", \"tmin_7\", \"tmin_8\", \"tmin_9\")]\n    data$varID <- x\n    data$gcm <- y\n    data$Period <- '2030'\n    return(data)\n  })\n  process <- do.call(rbind, process)\n  return(process)\n})\nfut2030Info <- do.call(rbind, fut2030Info) #Join in only one table\nhead(fut2030Info)\n\n# Future 2050\nfut2050Info <- lapply(metrics, function(x){\n  process <- lapply(gcmList, function(y){\n    file <- list.files(path = './_2050/', pattern = x, full.names = T)\n    file <- file[grep(pattern = paste('_', y, '_2050', sep = ''), x = file)]\n    data <- read.csv(file)\n    data <- data[, c(\"zone\", \"prec_1\", \"prec_10\", \"prec_11\", \"prec_12\", \"prec_2\", \"prec_3\", \"prec_4\", \"prec_5\", \"prec_6\", \"prec_7\", \"prec_8\", \"prec_9\",\n                        \"tmax_1\", \"tmax_10\", \"tmax_11\", \"tmax_12\", \"tmax_2\", \"tmax_3\", \"tmax_4\", \"tmax_5\", \"tmax_6\", \"tmax_7\", \"tmax_8\", \"tmax_9\",\n                        \"tmean_1\", \"tmean_10\", \"tmean_11\", \"tmean_12\", \"tmean_2\", \"tmean_3\", \"tmean_4\", \"tmean_5\", \"tmean_6\", \"tmean_7\", \"tmean_8\", \"tmean_9\",\n                        \"tmin_1\", \"tmin_10\", \"tmin_11\", \"tmin_12\", \"tmin_2\", \"tmin_3\", \"tmin_4\", \"tmin_5\", \"tmin_6\", \"tmin_7\", \"tmin_8\", \"tmin_9\")]\n    data$varID <- x\n    data$gcm <- y\n    data$Period <- '2050'\n    return(data)\n  })\n  process <- do.call(rbind, process)\n  return(process)\n})\nfut2050Info <- do.call(rbind, fut2050Info)\n\n# all info in just one dataset\nall_data <- rbind(currentInfo, fut2030Info, fut2050Info); rm(currentInfo, fut2030Info, fut2050Info, gcmList, metrics)\n\nprecData <- all_data[,c('zone', 'varID', 'gcm', 'Period', paste('prec_', 1:12, sep=''))] #data organization\ntminData <- all_data[,c('zone', 'varID', 'gcm', 'Period', paste('tmin_', 1:12, sep=''))]\ntmeaData <- all_data[,c('zone', 'varID', 'gcm', 'Period', paste('tmean_', 1:12, sep=''))]\ntmaxData <- all_data[,c('zone', 'varID', 'gcm', 'Period', paste('tmax_', 1:12, sep=''))]\n\nprecData        <- precData %>% gather(month, prec, prec_1:prec_12) #uso of gather\nprecData$month  <- as.numeric(as.character(gsub(pattern = 'prec_', replacement = '', x = precData$month)))\n\ntminData        <- tminData %>% gather(month, tmin, tmin_1:tmin_12)\ntminData$month  <- as.numeric(as.character(gsub(pattern = 'tmin_', replacement = '', x = tminData$month)))\n\ntmeaData        <- tmeaData %>% gather(month, tmean, tmean_1:tmean_12)\ntmeaData$month  <- as.numeric(as.character(gsub(pattern = 'tmean_', replacement = '', x = tmeaData$month)))\n\ntmaxData        <- tmaxData %>% gather(month, tmax, tmax_1:tmax_12)\ntmaxData$month  <- as.numeric(as.character(gsub(pattern = 'tmax_', replacement = '', x = tmaxData$month)))\n\nall_data2       <- Reduce(function(...) merge(..., by=c('zone', 'varID', 'gcm', 'Period', 'month'), all.x=TRUE), list(precData, tminData, tmeaData, tmaxData))\nrm(precData, tminData, tmeaData, tmaxData)\nall_data2$month <- factor(x = all_data2$month, levels = 1:12, ordered = TRUE) #conversion to factor to month\n\n# summarize future information by period\nprecData <- all_data2 %>% group_by(zone, varID, Period, month) %>% summarise(mean(prec))\nnames(precData)[length(precData)] <- 'prec' #change header\ntminData <- all_data2 %>% group_by(zone, varID, Period, month) %>% summarise(mean(tmin))\nnames(tminData)[length(tminData)] <- 'tmin'\ntmeaData <- all_data2 %>% group_by(zone, varID, Period, month) %>% summarise(mean(tmean))\nnames(tmeaData)[length(tmeaData)] <- 'tmean'\ntmaxData <- all_data2 %>% group_by(zone, varID, Period, month) %>% summarise(mean(tmax))\nnames(tmaxData)[length(tmaxData)] <- 'tmax'\n\n# summarize future information by period sd\nsdprecData <- all_data2 %>% group_by(zone, varID, Period, month) %>% summarise(sd(prec))\nnames(sdprecData)[length(sdprecData)] <- 'sd_prec'\nsdprecData$sd_prec[sdprecData$Period=='current'] <- 0\n\n#all_data3       <- Reduce(function(...) merge(..., by=c('zone', 'varID', 'Period', 'month'), all.x=TRUE), list(precData, tminData, tmeaData, tmaxData))\nall_data3       <- Reduce(function(...) merge(..., by=c('zone', 'varID', 'Period', 'month'), all.x=TRUE), list(precData, tminData, tmeaData, tmaxData, sdprecData))\n#rm(precData, tminData, tmeaData, tmaxData)\nrm(precData, tminData, tmeaData, tmaxData, sdprecData)\nall_data3$month <- gsub(pattern = 10, replacement = 'Oct', x = all_data3$month, fixed = T)\nall_data3$month <- gsub(pattern = 11, replacement = 'Nov', x = all_data3$month, fixed = T)\nall_data3$month <- gsub(pattern = 12, replacement = 'Dec', x = all_data3$month, fixed = T)\nall_data3$month <- gsub(pattern = 1, replacement = 'Jan', x = all_data3$month, fixed = T)\nall_data3$month <- gsub(pattern = 2, replacement = 'Feb', x = all_data3$month, fixed = T)\nall_data3$month <- gsub(pattern = 3, replacement = 'Mar', x = all_data3$month, fixed = T)\nall_data3$month <- gsub(pattern = 4, replacement = 'Apr', x = all_data3$month, fixed = T)\nall_data3$month <- gsub(pattern = 5, replacement = 'May', x = all_data3$month, fixed = T)\nall_data3$month <- gsub(pattern = 6, replacement = 'Jun', x = all_data3$month, fixed = T)\nall_data3$month <- gsub(pattern = 7, replacement = 'Jul', x = all_data3$month, fixed = T)\nall_data3$month <- gsub(pattern = 8, replacement = 'Aug', x = all_data3$month, fixed = T)\nall_data3$month <- gsub(pattern = 9, replacement = 'Sep', x = all_data3$month, fixed = T)\nall_data3$month  <- factor(all_data3$month, levels = c('Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'), ordered = TRUE)\nall_data3$Period <- gsub(pattern = 'current', replacement = 'Current', x = all_data3$Period)\nall_data3$Period <- factor(x = all_data3$Period, levels = c('Current', '2030', '2050'), ordered = T)\n\n# temperature in original units\nall_data3$tmin  <- all_data3$tmin/10\nall_data3$tmean <- all_data3$tmean/10\nall_data3$tmax  <- all_data3$tmax/10\n\n# load script to do dual axis\nmax_zone_1 <- all_data3[all_data3$zone & all_data3$varID=='mean',] %>% # PRECIPITACION\n\t\t\t\t  mutate(val_up = prec + sd_prec) %>%\n\t\t\t\t  summarise(max(val_up))\n\nmax_zone__temp <- all_data3[all_data3$zone & all_data3$varID=='mean',] %>%\n\t\t\t\t  mutate(val_up = tmax) %>%\n\t\t\t\t  summarise(max(val_up))\n\nall_data4 <- all_data3 %>% filter(Period %in% c('Current', 2030))\n\ndf_prec <- filter(all_data3, Period %in% c('2030', '2050'))\n\n\nall_data3$Period <- gsub('Current', 'Línea base', all_data3$Period) \nall_data3$Period <- factor(x = all_data3$Period, levels = c('Línea base', '2030', '2050'), ordered = T)\n\n# Zone 1\n#gg <- ggplot(data = all_data3[all_data3$zone==1 & all_data3$varID=='mean',], aes(x = month, y = prec)) + geom_bar(aes(fill = Period), stat = \"identity\", position = \"dodge\")\n# gg <- ggplot(data = all_data3[all_data3$zone==1 & all_data3$varID=='mean',], aes(x = month, y = prec)) + \n#         geom_bar(aes(fill = Period), stat = \"identity\", position = \"dodge\") + \n#         geom_errorbar(aes(ymin = prec - sd_prec, ymax = prec + sd_prec, group = Period), width=.2, position=position_dodge(.9))\ngg <- ggplot(data = all_data3[all_data3$zone==1 & all_data3$varID=='mean',], aes(x = month, y = prec)) + \n        geom_bar(aes(fill = Period), stat = \"identity\", position = \"dodge\") + \n        geom_errorbar(aes(ymin = prec - sd_prec, ymax = prec + sd_prec, group = Period), width=.2, position=position_dodge(.9)) #+ \n        # geom_point(data = df_prec, aes(x = month, y = sd_prec, fill = Period, size = 13), colour = 'black')\ngg <- gg + theme_bw() + xlab('') + ylab('Precipitación (mm)')\ngg <- gg + theme(legend.position = \"top\") + labs(fill = '') #top\ngg <- gg + scale_y_continuous(limits = c(0, 450), breaks = c(50,100,150,200,250,300,350,400,450)) #A?adido por Fabio\ngg <- gg + theme(panel.grid.major.x = element_blank(),\n                 panel.grid.minor.x = element_blank(),\n                 panel.grid.major.y = element_line(),\n                 panel.grid.minor.y = element_blank(),\n                 panel.border = element_blank())\ngg <- gg + ggtitle(\"\") + theme(panel.grid.major = element_line())#theme(panel.grid.major = element_line(colour = \"grey\"))\n# gg <- gg + scale_fill_manual(values = c('#CC3333', '#7da838', '#295582'))\n# gg <- gg + scale_fill_manual(values = c('#618725', '#1D4268', '#851B19'))\n# gg <- gg + scale_fill_manual(values = c('#333333', '#666666', '#999999'))\ngg <- gg + scale_fill_manual(values = c('#beca5c', '#6b8d3c', '#4b753b'))\n\n\n# gg2 <- ggplot(data = all_data3[all_data3$zone==1 & all_data3$varID=='mean',], aes(x = month, y = tmean)) + \n#           geom_line(aes(colour = Period, group = Period))\n# gg2 <- gg2 + geom_line(data = all_data3[all_data3$zone==1 & all_data3$varID=='mean',], aes(x = month, y = tmin, colour = Period, group = Period), linetype = 2)\n# gg2 <- gg2 + geom_line(data = all_data3[all_data3$zone==1 & all_data3$varID=='mean',], aes(x = month, y = tmax, colour = Period, group = Period), linetype = 2)\n\ngg2 <- ggplot(data = all_data3[all_data3$zone==1 & all_data3$varID=='mean',], aes(x = month, y = tmean)) + \n          geom_line(aes(colour = Period, group = Period))\ngg2 <- gg2 + geom_line(data = all_data3[all_data3$zone==1 & all_data3$varID=='mean',], aes(x = month, y = tmin, colour = Period, group = Period), linetype = 2)\ngg2 <- gg2 + geom_line(data = all_data3[all_data3$zone==1 & all_data3$varID=='mean',], aes(x = month, y = tmax, colour = Period, group = Period), linetype = 2)\n\ngg2 <- gg2 + theme_bw() + xlab('') + ylab(expression(\"Temperatura (\"*~degree*C*\")\"))\ngg2 <- gg2 + scale_y_continuous(limits = c(0, 36)) \ngg2 <- gg2 + theme(panel.grid.major.x = element_blank(),\n                   panel.grid.minor.x = element_blank(),\n                   panel.grid.major.y = element_blank(),\n                   panel.grid.minor.y = element_blank(),\n                   panel.grid = element_blank(),\n                   panel.border = element_blank())\n                   # panel.grid.major = element_blank()) #colour = 'green'\n# gg2 <- gg2 + scale_color_manual(values = c('#CC3333', '#7da838', '#295582'))\n# gg2 <- gg2 + scale_color_manual(values = c('#618725', '#1D4268', '#851B19'))\n# gg2 <- gg2 + scale_color_manual(values = c('#333333', '#666666', '#999999'))\ngg2 <- gg2 + scale_color_manual(values = c('#beca5c', '#6b8d3c', '#4b753b'))\n\npng(filename = 'pntsCocoa.png', width = 9, height = 8, units = 'in', res = 300)\nggplot_dual_axis(gg, gg2, \"y\")\ndev.off()\n\n# Zone 2\n#gg <- ggplot(data = all_data3[all_data3$zone==1 & all_data3$varID=='mean',], aes(x = month, y = prec)) + geom_bar(aes(fill = Period), stat = \"identity\", position = \"dodge\")\ngg <- ggplot(data = all_data3[all_data3$zone==2 & all_data3$varID=='mean',], aes(x = month, y = prec)) + geom_bar(aes(fill = Period), stat = \"identity\", position = \"dodge\") + geom_errorbar(aes(ymin = prec - sd_prec, ymax = prec + sd_prec, group = Period), width=.2, position=position_dodge(.9))\ngg <- gg + theme_bw() + xlab('Months') + ylab('Precipitation (mm)')\ngg <- gg + theme(legend.position = \"top\")\ngg <- gg + scale_y_continuous(limits = c(0, 250), breaks = c(50,100,150,200,250)) #A?adido por Fabio\n#gg <- gg + theme(panel.grid.major.x = element_blank(),\n#panel.grid.minor.x = element_blank(),\n#panel.grid.major.y = element_blank(),\n#panel.grid.minor.y = element_blank())\ngg <- gg + ggtitle(\"Lwasho\") + theme(panel.grid.major = element_line(colour = \"grey\"))\n\ngg2 <- ggplot(data = all_data3[all_data3$zone==2 & all_data3$varID=='mean',], aes(x = month, y = tmean)) + geom_line(aes(colour = Period, group = Period))\ngg2 <- gg2 + geom_line(data = all_data3[all_data3$zone==2 & all_data3$varID=='mean',], aes(x = month, y = tmin, colour = Period, group = Period), linetype = 2)\ngg2 <- gg2 + geom_line(data = all_data3[all_data3$zone==2 & all_data3$varID=='mean',], aes(x = month, y = tmax, colour = Period, group = Period), linetype = 2)\ngg2 <- gg2 + theme_bw() + xlab('Months') + ylab(expression(\"Temperature (\"*~degree*C*\")\"))\ngg2 <- gg2 + scale_y_continuous(limits = c(0, 34)) \ngg2 <- gg2 + theme(panel.grid.major.x = element_blank(),\n                   panel.grid.minor.x = element_blank(),\n                   panel.grid.major.y = element_blank(),\n                   panel.grid.minor.y = element_blank()) \n\n\npng(filename = \"../Lwasho.png\", width = 9, height = 8, units = 'in', res = 300)\nggplot_dual_axis(gg, gg2, \"y\")\ndev.off()\n\n# Zone 3\n#gg <- ggplot(data = all_data3[all_data3$zone==1 & all_data3$varID=='mean',], aes(x = month, y = prec)) + geom_bar(aes(fill = Period), stat = \"identity\", position = \"dodge\")\ngg <- ggplot(data = all_data3[all_data3$zone==3 & all_data3$varID=='mean',], aes(x = month, y = prec)) + geom_bar(aes(fill = Period), stat = \"identity\", position = \"dodge\") + geom_errorbar(aes(ymin = prec - sd_prec, ymax = prec + sd_prec, group = Period), width=.2, position=position_dodge(.9))\ngg <- gg + theme_bw() + xlab('Months') + ylab('Precipitation (mm)')\ngg <- gg + theme(legend.position = \"top\")\ngg <- gg + scale_y_continuous(limits = c(0, 250), breaks = c(50,100,150,200,250)) #A?adido por Fabio\n#gg <- gg + theme(panel.grid.major.x = element_blank(),\n#panel.grid.minor.x = element_blank(),\n#panel.grid.major.y = element_blank(),\n#panel.grid.minor.y = element_blank())\ngg <- gg + ggtitle(\"Myunga\") + theme(panel.grid.major = element_line(colour = \"grey\"))\n\ngg2 <- ggplot(data = all_data3[all_data3$zone==3 & all_data3$varID=='mean',], aes(x = month, y = tmean)) + geom_line(aes(colour = Period, group = Period))\ngg2 <- gg2 + geom_line(data = all_data3[all_data3$zone==3 & all_data3$varID=='mean',], aes(x = month, y = tmin, colour = Period, group = Period), linetype = 2)\ngg2 <- gg2 + geom_line(data = all_data3[all_data3$zone==3 & all_data3$varID=='mean',], aes(x = month, y = tmax, colour = Period, group = Period), linetype = 2)\ngg2 <- gg2 + theme_bw() + xlab('Months') + ylab(expression(\"Temperature (\"*~degree*C*\")\"))\ngg2 <- gg2 + scale_y_continuous(limits = c(0, 34)) \ngg2 <- gg2 + theme(panel.grid.major.x = element_blank(),\n                   panel.grid.minor.x = element_blank(),\n                   panel.grid.major.y = element_blank(),\n                   panel.grid.minor.y = element_blank()) \n\n\npng(filename = \"../Miunga.png\", width = 9, height = 8, units = 'in', res = 300)\nggplot_dual_axis(gg, gg2, \"y\")\ndev.off()\n\n\n",
    "created" : 1512412966583.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "66|41|78|2|\n",
    "hash" : "1850141082",
    "id" : "891AE505",
    "lastKnownWriteTime" : 1512415008,
    "last_content_update" : 1512415008609,
    "path" : "Z:/_cam/_codes/_r/_niceGraph/3_dual_axis_precTemp.R",
    "project_path" : "3_dual_axis_precTemp.R",
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}