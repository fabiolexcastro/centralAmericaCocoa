{
    "collab_server" : "",
    "contents" : "\n# CIAT, 2017\n# Author: Mesa & Castro \n# Target: Impact gradient cluster\n\nlibrary(ggalt)\nlibrary(hrbrthemes)\nlibrary(tidyverse)\nlibrary(raster)\nlibrary(rgdal)\nlibrary(magrittr)\n\n# Initial setup\nrm(list = ls())\nOSys <- Sys.info(); OSys <- OSys[names(OSys)=='sysname']\nif(OSys == 'Linux'){\n  setwd('//mnt/Workspace_cluster_9/Coffee_Cocoa2/_cam')\n} else {\n  if(OSys == 'Windows'){\n    setwd('//dapadfs/Workspace_cluster_9/Coffee_Cocoa2/_cam')\n  }\n}\ncat('\\f')\n\n# Execute\nall_options <- read_csv('_tables/classesImpGraLimMix.csv')\nyears <- c(2030, 2050)\nlabelss <- data.frame(value = c(0, 1, 2, 3, 4, 5), category = c('Unsuit', 'cope', 'adjust', 'transform', 'opportunity', 'resilience'))# labelss <- data.frame(value = c(1, 2, 3, 4, 5, 6), category = c('cope', 'adjust', 'transform', 'opportunity', 'limitations', 'limitations')) #NEW\n\nrun <- '_run6'\ncurrent <- raster(paste0('_RF/', run, '/_results/_process/_percentil0_5/_mixed/RF_5Classes_unccurrent.asc'))\nfuture_30 <- raster(paste0('_RF/', run, '/_results/_process/_percentil0_5/_mixed/RF_5Classes_unc_2030.asc'))\nfuture_50 <- raster(paste0('_RF/', run, '/_results/_process/_percentil0_5/_mixed/RF_5Classes_unc_2050.asc'))\n\nunique(all_options$current)\nunique(all_options$future)\nunique(all_options$category)\nunique(current[])\nunique(future_30[])\nunique(future_50[])\n\n# Impact gradient\nreclassify_options <- function(x, y, labels, options){\n\n  require(tidyverse)\n  # x <- current #Proof\n  # y <- future_50 #Proof\n  \n  temp_raster    <- x\n  name_raster_x  <- names(x)\n  name_raster_y  <- names(y)\n  \n  coordinates_df <- coordinates(x)\n  x              <- as.data.frame(raster::extract(x, coordinates_df, cellnumbers = TRUE))\n  number_cell    <- dplyr::select(x, cells)\n  x              <- select_(x, name_raster_x)\n  colnames(x)    <- 'current'\n  \n  y              <- as.data.frame(raster::extract(y, coordinates_df[,c('x', 'y')], cellnumbers = TRUE))\n  y              <- select_(y, name_raster_y)\n  colnames(y)    <- 'future'\n  \n  z              <- data.frame(x, y, number_cell) %>%\n                      as_tibble()\n  \n  print(\"Results...\")\n  sort(unique(z$current))\n  sort(unique(z$future))\n  results        <- left_join(z, all_options, by = c('current', 'future'))\n  labels         <- as_tibble(labelss) \n  unique(results$category)\n  \n  # results        <- results %>%\n  #                     mutate(category = as.factor(category))\n  \n  results_1      <- left_join(results, labels, by = 'category') %>%#full_join\n                      dplyr::select(value) %>%\n                        extract2(1)\n  \n  length(results_1)\n  print(\"Done!\")\n  \n  temp_raster    <- raster::setValues(temp_raster, results_1)\n  \n  return(temp_raster)\n  \n}\n\n# raster_fut <- list(future_30, future_50)\n# resultsss <- lapply(1:length(raster_fut), function(x){ \n#   \n#                 resultss <- reclassify_options(current, raster_fut[[x]], labells, all_options)\n#                 return(resultss)\n#                 \n#               })\n# z_2030 <- resultsss[[1]]\n\nz_2030      <- reclassify_options(current, future_30, labelss, all_options)\n\nsystem.time(expr = {\n  \n  z_2050 <- reclassify_options(current, future_50, labelss, all_options)  \n  \n})\n\nwriteRaster(z_2030, paste0('_RF/', run, '/_results/_process/_percentil0_5/_impGra/Cluster_change_2030.asc'), overwrite = TRUE)\nwriteRaster(z_2050, paste0('_RF/', run, '/_results/_process/_percentil0_5/_impGra/Cluster_change_2050.asc'), overwrite = TRUE)\n\n\nrequire(raster)\ntst <- raster('Z:/_cam/_RF/_run6/_results/_process/RF_5Classes_unccurrent.asc')\nunique(tst[])\nhist(tst[])\ntable(tst[])\n",
    "created" : 1510162012515.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1137859410",
    "id" : "CCFCBB8E",
    "lastKnownWriteTime" : 1512073255,
    "last_content_update" : 1512073255468,
    "path" : "Z:/_cam/_codes/_r/_categories/4_impactGradient_uncMix.R",
    "project_path" : "4_impactGradient_uncMix.R",
    "properties" : {
    },
    "relative_order" : 6,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}